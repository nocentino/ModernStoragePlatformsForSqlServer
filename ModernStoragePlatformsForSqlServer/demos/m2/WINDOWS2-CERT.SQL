CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'Strong Password';
GO
CREATE CERTIFICATE WINDOWS2_Cert 
WITH SUBJECT = 'WINDOWS2 Certificate',
	EXPIRY_DATE='08/18/2031';
GO
BACKUP CERTIFICATE WINDOWS2_Cert 
    TO FILE =  '\\WINDOWS2\BACKUP\WINDOWS2_Cert.cer'
    WITH PRIVATE KEY ( FILE =  '\\WINDOWS2\BACKUP\WINDOWS2_Cert.key' ,   
    ENCRYPTION BY PASSWORD = '997jkhUbhk$w4ez0876hKHJH5gh' );  
GO
CREATE LOGIN WINDOWS1_Login WITH PASSWORD = 'Strong Password';
GO
CREATE USER WINDOWS1_User FOR LOGIN WINDOWS1_Login;
GO


CREATE CERTIFICATE [WINDOWS1_Cert]   
	AUTHORIZATION WINDOWS1_User
    FROM FILE = '\\WINDOWS2\BACKUP\WINDOWS1_Cert.cer'
    WITH PRIVATE KEY (FILE = '\\WINDOWS2\BACKUP\WINDOWS1_Cert.key',   
    DECRYPTION BY PASSWORD = '997jkhUbhk$w4ez0876hKHJH5gh');  
GO

CREATE ENDPOINT DIAG_EP
STATE = STARTED
AS TCP (   
	LISTENER_PORT = 5022,
	LISTENER_IP = ALL
      )
FOR DATABASE_MIRRORING (
	AUTHENTICATION = CERTIFICATE WINDOWS1_Cert, 

	ROLE = ALL
      )
GO
GRANT CONNECT ON ENDPOINT::DIAG_EP TO [WINDOWS1_Login];
GO




drop certificate WINDOWS1_cert
drop certificate WINDOWS2_cert
drop login WINDOWS1_login
drop user WINDOWS1_user